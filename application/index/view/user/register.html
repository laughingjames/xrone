<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<!--Head-->
<head>
    <meta charset="utf-8" />
    <title>Register Page</title>
    <meta name="description" content="register page" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">
    <!--Basic Styles-->
    <link href="__CSS__/bootstrap.4.0.0.min.css" rel="stylesheet" />
    <link href="__CSS__/font-awesome.min.css" rel="stylesheet" />
    <link id="beyond-link" href="__CSS__/user/beyond.min.css" rel="stylesheet" />
    <link href="__CSS__/user/user.min.css" rel="stylesheet" />
    <link href="__CSS__/user/animate.min.css" rel="stylesheet" />
    <link id="skin-link" href="" rel="stylesheet" type="text/css" />
    <link href="__CSS__/user/animate.min.css" rel="stylesheet" />
    <!--Basic Scripts-->
    <script src="__JS__/jquery-2.2.3.min.js"></script>
    <script src="__JS__/bootstrap.min.js"></script>
    <script src="__JS__/md5.js"></script>
    <!--Beyond Scripts-->
    <script src="__JS__/user/skins.min.js"></script>
    <link href="__CSS__/jquery.mloading.css" rel="stylesheet" />

    <script src="__JS__/jquery.mloading.js"></script>
    <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">
    <link id="bootstrap-rtl-link" href="" rel="stylesheet" />
    <style>
        .head-image {

            margin-top: 15px;
            position: relative;
            text-align: center;
            display: inline-block;
            background: #D0EEFF;
            border: 1px solid #99D3F5;
            border-radius: 50px;
            padding: 4px 12px;
            overflow: hidden;
            color: #1E88C7;
            text-decoration: none;
            text-indent: 0;
            line-height: 20px;
        }
        .head-image input {

            position: absolute;
            font-size: 100px;
            right: 0;
            top: 0;
            opacity: 0;

        }
        .head-image:hover {
            background: #AADFFD;
            border-color: #78C3F3;
            color: #004974;
            text-decoration: none;
        }
    </style>

</head>
<!--Head Ends-->
<!--Body-->
<body>
<div class="register-container animated fadeInDown">
    <div class="registerbox bg-white">
        <div class="registerbox-title">Register</div>
        <div class="registerbox-caption ">Please fill in your information</div>
        <div class="registerbox-head-img">
            <canvas hidden="hidden" id="cvs_hidden"></canvas>

            <canvas style="margin-left:20px;border: 1px black solid;border-radius: 50px;" id="cvs" width="100" height="100"></canvas>
            <a href="javascript:;" class="head-image">Click to Choose Head-icon
                <input   width="100" height="100" accept="image/jpg,image/jped,image/png,image/bmp,image/JPG,image/JPEG,image/PNG,image/BMP" type="file" name="" id="upload">
            </a>
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="phone_no" name="phone_no" placeholder="Phone No."  onkeyup="this.value=this.value.replace(/[^0-9]+/,'');"/>
        </div>
        <div class="registerbox-textbox">
            <input type="password" class="form-control" id="password" name="password"  placeholder="Enter Password" />
        </div>

        <div class="registerbox-textbox">
            <input type="password" class="form-control" id="password1" name="password1" name="twice_password"  placeholder="Confirm Password" />
        </div>
        <div id="password_alert" style="display: none;color: red;margin-left: 16px">
            Password is not the same.
        </div>
        <hr class="wide" />
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="name" name="name" placeholder="Name" />
        </div>
        <div class="registerbox-textbox">
           Sex <select id="sex">
                <option value ="0">Boy</option>
                <option value ="1">Girl</option>
            </select>
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="email"  name="email" placeholder="Email." />
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="major" name="major" placeholder="What's ur major?" />
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="interest" name="interest" placeholder="What's ur interest?" />
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="country" name="country" placeholder="Country" />
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="passport_no" name="Passport_no" placeholder="Passport No." />
        </div>

        <!--<div class="registerbox-textbox no-padding-bottom">-->
        <!--<div class="checkbox">-->
        <!--<label>-->
        <!--<input type="checkbox" class="colored-primary" checked="checked">-->
        <!--<span class="text darkgray">I agree to the  <a class="themeprimary">HelloHelper of Service</a> and Privacy Policy</span>-->
        <!--</label>-->
        <!--</div>-->
        <!--</div>-->
        <div class="registerbox-submit">
            <input type="button" class="btn btn-primary pull-right" value="SUBMIT">
        </div>
    </div>
    <div class="logobox">
    </div>


</div>



<!--Google Analytics::Demo Only-->
<script>
    $("body").mLoading({
        text:"Please wating....",//加载文字，默认值：加载中...
        icon:"",//加载图标，默认值：一个小型的base64的gif图片
        html:false,//设置加载内容是否是html格式，默认值是false
        content:"Please wating....",//忽略icon和text的值，直接在加载框中显示此值
        mask:true//是否显示遮罩效果，默认显示
    });
    $("body").mLoading("hide");//隐藏loading组件
    var headdata;
    var input1 = document.getElementById("upload");

    if(typeof FileReader==='undefined'){
        //result.innerHTML = "抱歉，你的浏览器不支持 FileReader";
        input1.setAttribute('disabled','disabled');
    }else{
        input1.addEventListener('change',readFile,false);
        /*input1.addEventListener('change',function (e){
            console.log(this.files);//上传的文件列表
        },false); */
    }
    function readFile(){
        var file = this.files[0];//获取上传文件列表中第一个文件
        if(!/image\/\w+/.test(file.type)){
            //图片文件的type值为image/png或image/jpg
            alert("文件必须为图片！");
            return false;
        }
        // console.log(file);
        var reader = new FileReader();//实例一个文件对象
        reader.readAsDataURL(file);//把上传的文件转换成url
        //当文件读取成功便可以调取上传的接口
        reader.onload = function(e){

//             console.log(this.result);//文件路径
//            console.log(e.target.result);//文件路径
            var data = e.target.result.split(',');
            var tp = (file.type == 'image/png')? 'png': 'jpg';
            var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
            //需要上传到服务器的在这里可以进行ajax请求
//            console.log(e.target.result);
            headdata=e.target.result;
            // 创建一个 Image 对象
            /*var image = new Image();
            // 创建一个 Image 对象
            // image.src = imgUrl;
            image.src = e.target.result;
            image.onload = function(){
                document.body.appendChild(image);
            }*/

            var image = new Image();
            // 设置src属性
            image.src = e.target.result;
            var max=1024;
            // 绑定load事件处理器，加载完成后执行，避免同步问题
            image.onload = function(){

                // 获取 canvas DOM 对象
                var canvas = document.getElementById("cvs");
                var canvas_hidden = document.getElementById("cvs_hidden");
                // 如果高度超标 宽度等比例缩放 *=

                if(image.height > max) {
                    image.width *= max / image.height;
                    image.height = max;
                }

                $("#cvs_hidden").attr('width',image.width);
                $("#cvs_hidden").attr('height',image.height);
                var ctx_hidden = canvas_hidden.getContext("2d");
                ctx_hidden.clearRect(0, 0, canvas_hidden.width, canvas_hidden.height);
                ctx_hidden.drawImage(image, 0, 0, image.width, image.height);
                headdata=canvas_hidden.toDataURL('image/jpeg',1.0);

                // 获取 canvas的 2d 环境对象,
                var ctx = canvas.getContext("2d");
                // canvas清屏
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // 重置canvas宽高
                /*canvas.width = image.width;
                canvas.height = image.height;
                if (canvas.width>max) {canvas.width = max;}*/
                // 将图像绘制到canvas上
//                 ctx.drawImage(image, 0, 0, image.width, image.height);
                ctx.drawImage(image, 0, 0, 100, 100);


                console.log(headdata);

                // 注意，此时image没有加入到dom之中
            };

        }
    };
    $(document).ready(function(){

        $("input[type='button']").click(function () {
            $phone_no=$('#phone_no').val();
            $country=$('#country').val();
            $name=$('#name').val();
            $password=$('#password').val();
            $passport_no=$('#passport_no').val();
            $interest=$('#interest').val();
            $major=$('#major').val();
            if(checkdata()){
                post_data();
            }
        });
        function checkdata() {
            var reg=/^[A-Za-z][A-Za-z\s]*[A-Za-z]$/;
            if(!$('#upload').val()){
                alert("Please choose a head icon.");
                return false;
            }else if($phone_no==''||$country==''||$name==''||$passport_no==''){
                alert('Data can\'t be empty. ');
                return false;
            }else if($phone_no.length!=11){
                alert('Phone No is invalid,Please check.');
                return false;
            }else if($password.length<6) {
                alert('Password lengh must be over 6 numbers.');
                return false;
            }
//            else if(!reg.test($name)){
//                alert('Name Contains illegal characters.');
//                return false;
//            }
//            else if(!reg.test($country)){
//                alert('Country Contains illegal characters.');
//                return false;
//            }

            return validate_pass();

        }

        /**
         * 验证密码
         */
        function validate_pass() {
            var pwd = $("#password").val();
            var pwd1 = $("#password1").val();
            <!-- 对比两次输入的密码 -->
            if (pwd == pwd1) {
                return true;
            }
            else {
                $ ('#password_alert').show ().delay (3000).fadeOut ();
                return false;
            }
        }

        /**
         * 发送数据
         */
        function post_data() {

            $("body").mLoading("show");//显示loading组件

            $.post('/index/user/register_action', {
                phone_no:$('#phone_no').val(),
                password:$('#password').val(),
                country:$('#country').val(),
                name:$('#name').val(),
                email:$('#email').val(),
                passport_no:$('#passport_no').val(),
                interest:$('#interest').val(),
                major:$('#major').val(),
                headimg:headdata,
                sex:$('#sex').val(),
            },function(code,status){
                $("body").mLoading("hide");//隐藏loading组件
                if(status=="success"){
                    if(code==200){
                        alert("Register Successful.");
                        window.history.back();
                    }else if(code==202){
                        alert("This Phone No has already register.Please contact Administrator.");
                    }else{
                        alert("Register Fail.");
                    }

                }else{
                    alert("Request Fail.");
                }
            });
        }
    });

    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'http://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-52103994-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
<!--Body Ends-->
</html>
