<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<!--Head-->
<head>
    <meta charset="utf-8" />
    <title>Register Page</title>
    <meta name="description" content="register page" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--Basic Styles-->
    <link href="__CSS__/bootstrap.4.0.0.min.css" rel="stylesheet" />
    <link href="__CSS__/font-awesome.min.css" rel="stylesheet" />
    <link href="__CSS__/user/beyond.min.css"id="beyond-link"  rel="stylesheet" />
    <link href="__CSS__/user/user.min.css" rel="stylesheet" />
    <link href="__CSS__/user/animate.min.css" rel="stylesheet" />
    <link href="__CSS__/jquery.toast.css" rel="stylesheet" />
    <link href="__CSS__/user/animate.min.css" rel="stylesheet" />
    <link href="__CSS__/jquery.mloading.css" rel="stylesheet" />
    <link href="__PUBLIC__/view_res/mobile/css/login.css" type="text/css" rel="Stylesheet" />

    <!--Basic Scripts-->
    <script src="__JS__/jquery-2.2.3.min.js"></script>
    <script src="__JS__/bootstrap.min.js"></script>
    <script  src="__JS__/jquery/jquery.toast.js" type="text/javascript" ></script>
    <script src="__JS__/user/skins.min.js"></script>
    <script src="__JS__/jquery.mloading.js"></script>
    <style>
        .head-image {
            margin-top: 15px;
            position: relative;
            text-align: center;
            display: inline-block;
            background: #D0EEFF;
            border: 1px solid #99D3F5;
            border-radius: 50px;
            padding: 4px 12px;
            overflow: hidden;
            color: #1E88C7;
            text-decoration: none;
            text-indent: 0;
            line-height: 20px;
        }
        .head-image input {
            position: absolute;
            font-size: 100px;
            right: 0;
            top: 0;
            opacity: 0;
        }
        .head-image:hover {
            background: #AADFFD;
            border-color: #78C3F3;
            color: #004974;
            text-decoration: none;
        }
    </style>

</head>
<!--Head Ends-->
<!--Body-->
<body>
{block name="header"}
{include file="public/top-nav" /}
{/block}
<div class="register-container animated fadeInDown">
    <div class="registerbox bg-white">
        <div class="registerbox-title">Register</div>
        <div class="registerbox-caption ">Please fill in your information</div>
        <div class="registerbox-head-img">
            <canvas hidden="hidden" id="cvs_hidden"></canvas>
            <canvas style="margin-left:20px;border: 1px black solid;border-radius: 50px;" id="cvs" width="100" height="100"></canvas>
            <a href="javascript:;" class="head-image">Click to Choose Head-icon
                <input   width="100" height="100" accept="image/jpg,image/jped,image/png,image/bmp,image/JPG,image/JPEG,image/PNG,image/BMP" type="file" name="" id="upload">
            </a>
        </div>
        <div class="registerbox-textbox">
            <input type="text" maxlength="11" class="form-control" id="phone_no" name="phone_no" placeholder="Phone No."  onkeyup="this.value=this.value.replace(/[^0-9]+/,'');"/>
        </div>
        <div class="registerbox-textbox">
            <input type="password" class="form-control" id="password" name="password"  placeholder="Enter Password" />
        </div>

        <div class="registerbox-textbox">
            <input type="password" class="form-control" id="password1" name="password1" name="twice_password"  placeholder="Confirm Password" />
        </div>
        <div id="password_alert" style="display: none;color: red;margin-left: 16px">
            Password is not the same.
        </div>
        <hr class="wide" />
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="name" name="name" placeholder="Name" />
        </div>
        <div class="registerbox-textbox">
           Sex <select id="sex">
                <option value ="0">Boy</option>
                <option value ="1">Girl</option>
            </select>
        </div>
        <div class="registerbox-textbox">
            Country <select id="country" name="country" class="fastbannerform__country">
            <option value="ASA" title="AA" >America</option>
            <option value="AND" title="AD" >Andorra</option>
            <option value="ARE" title="AE" >United Arab Emirates</option>
            <option value="AFG" title="AF" >Afghanistan</option>
            <option value="ATG" title="AG" >Antigua and Barbuda</option>
            <option value="ALB" title="AL" >Albania</option>
            <option value="ARM" title="AM" >Armenia</option>
            <option value="AGO" title="AO" >Angola</option>
            <option value="ARG" title="AR" >Argentina</option>
            <option value="AUT" title="AT" >Austria</option>
            <option value="AUS" title="AU" >Australia</option>
            <option value="ABW" title="AW" >Aruba</option>
            <option value="AZE" title="AZ" >Azerbaijan</option>
            <option value="BIH" title="BA" >Bosnia and Herzegovina</option>
            <option value="BRB" title="BB" >Barbados</option>
            <option value="BGD" title="BD" >Bangladesh</option>
            <option value="BEL" title="BE" >Belgium</option>
            <option value="BFA" title="BF" >Burkina Faso</option>
            <option value="BGR" title="BG" >Bulgaria</option>
            <option value="BHR" title="BH" >Bahrain</option>
            <option value="BDI" title="BI" >Burundi</option>
            <option value="BEN" title="BJ" >Benin</option>
            <option value="BMU" title="BM" >Bermuda</option>
            <option value="BRN" title="BN" >Brunei</option>
            <option value="BOL" title="BO" >Bolivia</option>
            <option value="BRA" title="BR" >Brazil</option>
            <option value="BHS" title="BS" >Bahamas</option>
            <option value="BTN" title="BT" >Bhutan</option>
            <option value="BWA" title="BW" >Botswana</option>
            <option value="BLR" title="BY" >Belarus</option>
            <option value="BLZ" title="BZ" >Belize</option>
            <option value="CAN" title="CA" >Canada</option>
            <option value="COD" title="CD" >Democratic Republic of the Congo</option>
            <option value="CAF" title="CF" >Central African Republic</option>
            <option value="COG" title="CG" >Democratic Republic of the Congo</option>
            <option value="CHE" title="CH" >Switzerland</option>
            <option value="CHL" title="CL" >Chile</option>
            <option value="CMR" title="CM" >Cameroon</option>
            <option value="CHN" title="CN" selected="selected">China</option>
            <option value="COL" title="CO" >Colombia</option>
            <option value="CRI" title="CR" >Costa Rica</option>
            <option value="CUB" title="CU" >Cuba</option>
            <option value="CPV" title="CV" >Cape Verde</option>
            <option value="CYP" title="CY" >Cyprus</option>
            <option value="CZE" title="CZ" >Czech Republic</option>
            <option value="DEU" title="DE" >Germany</option>
            <option value="DJI" title="DJ" >Djibouti</option>
            <option value="DNK" title="DK" >Denmark</option>
            <option value="DMA" title="DM" >Dominica</option>
            <option value="DOM" title="DO" >Dominican Republic</option>
            <option value="DZA" title="DZ" >Algeria</option>
            <option value="ECU" title="EC" >Ecuador</option>
            <option value="EST" title="EE" >Estonia</option>
            <option value="EGY" title="EG" >Egypt</option>
            <option value="ERI" title="ER" >Eritrea</option>
            <option value="ESP" title="ES" >Spain</option>
            <option value="ETH" title="ET" >Ethiopia</option>
            <option value="FIN" title="FI" >Finland</option>
            <option value="FJI" title="FJ" >Fiji</option>
            <option value="FLK" title="FK" >Falkland Islands</option>
            <option value="FSM" title="FM" >Micronesia</option>
            <option value="FRO" title="FO" >Faroe Islands</option>
            <option value="FRA" title="FR" >France</option>
            <option value="GAB" title="GA" >Gabon</option>
            <option value="GBR" title="GB" >United Kingdom</option>
            <option value="GRD" title="GD" >Grenada</option>
            <option value="GEO" title="GE" >Georgia</option>
            <option value="GHA" title="GH" >Ghana</option>
            <option value="GIB" title="GI" >Gibraltar</option>
            <option value="GMB" title="GM" >Gambia</option>
            <option value="GIN" title="GN" >Guinea</option>
            <option value="GNQ" title="GQ" >Equatorial Guinea</option>
            <option value="GRC" title="GR" >Greece</option>
            <option value="GTM" title="GT" >Guatemala</option>
            <option value="GNB" title="GW" >Guinea-Bissau</option>
            <option value="GUY" title="GY" >Guyana</option>
            <option value="HKG" title="HK" >Hong Kong</option>
            <option value="HND" title="HN" >Honduras</option>
            <option value="HRV" title="HR" >Croatia</option>
            <option value="HTI" title="HT" >Haiti</option>
            <option value="HUN" title="HU" >Hungary</option>
            <option value="IDN" title="ID" >Indonesia</option>
            <option value="IRL" title="IE" >Ireland</option>
            <option value="ISR" title="IL" >Israel</option>
            <option value="IND" title="IN" >India</option>
            <option value="IRQ" title="IQ" >Iraq</option>
            <option value="IRN" title="IR" >Iran</option>
            <option value="ISL" title="IS" >Iceland</option>
            <option value="ITA" title="IT" >Italy</option>
            <option value="JAM" title="JM" >Jamaica</option>
            <option value="JOR" title="JO" >Jordan</option>
            <option value="JPN" title="JP" >Japan</option>
            <option value="KEN" title="KE" >Kenya</option>
            <option value="KGZ" title="KG" >Kyrgyzstan</option>
            <option value="KHM" title="KH" >Cambodia</option>
            <option value="KIR" title="KI" >Kiribati</option>
            <option value="COM" title="KM" >Comoros</option>
            <option value="KNA" title="KN" >Saint Kitts and Nevis</option>
            <option value="PRK" title="KP" >North Korea</option>
            <option value="KOR" title="KR" >South Korea</option>
            <option value="KWT" title="KW" >Kuwait</option>
            <option value="CYM" title="KY" >Cayman Islands</option>
            <option value="KAZ" title="KZ" >Kazakhstan</option>
            <option value="LAO" title="LA" >Laos</option>
            <option value="LBN" title="LB" >Lebanon</option>
            <option value="LCA" title="LC" >Saint Lucia</option>
            <option value="LIE" title="LI" >Liechtenstein</option>
            <option value="LKA" title="LK" >Sri Lanka</option>
            <option value="LBR" title="LR" >Liberia</option>
            <option value="LSO" title="LS" >Lesotho</option>
            <option value="LTU" title="LT" >Lithuania</option>
            <option value="LUX" title="LU" >Luxembourg</option>
            <option value="LVA" title="LV" >Latvia</option>
            <option value="LBY" title="LY" >Libya</option>
            <option value="MAR" title="MA" >Morocco</option>
            <option value="MCO" title="MC" >Monaco</option>
            <option value="MDA" title="MD" >Moldova</option>
            <option value="MNE" title="ME" >Montenegro</option>
            <option value="MDG" title="MG" >Madagascar</option>
            <option value="MKD" title="MK" >Macedonia</option>
            <option value="MLI" title="ML" >Mali</option>
            <option value="MMR" title="MM" >Myanmar</option>
            <option value="MNG" title="MN" >Mongolia</option>
            <option value="MAC" title="MO" >Macao</option>
            <option value="MRT" title="MR" >Mauritania</option>
            <option value="MLT" title="MT" >Malta</option>
            <option value="MUS" title="MU" >Mauritius</option>
            <option value="MDV" title="MV" >Maldives</option>
            <option value="MWI" title="MW" >Malawi</option>
            <option value="MEX" title="MX" >Mexico</option>
            <option value="MYS" title="MY" >Malaysia</option>
            <option value="MOZ" title="MZ" >Mozambique</option>
            <option value="NAM" title="NA" >Namibia</option>
            <option value="NER" title="NE" >Niger</option>
            <option value="NGA" title="NG" >Nigeria</option>
            <option value="NIC" title="NI" >Nicaragua</option>
            <option value="NLD" title="NL" >Netherlands</option>
            <option value="NOR" title="NO" >Norway</option>
            <option value="NPL" title="NP" >Nepal</option>
            <option value="NRU" title="NR" >Nauru</option>
            <option value="NZL" title="NZ" >New Zealand</option>
            <option value="OMN" title="OM" >Oman</option>
            <option value="PAN" title="PA" >Panama</option>
            <option value="PER" title="PE" >Peru</option>
            <option value="PNG" title="PG" >Papua New Guinea</option>
            <option value="PHL" title="PH" >Philippines</option>
            <option value="PAK" title="PK" >Pakistan</option>
            <option value="POL" title="PL" >Poland</option>
            <option value="PRI" title="PR" >Puerto Rico</option>
            <option value="PSE" title="PS" >Palestine</option>
            <option value="PRT" title="PT" >Portugal</option>
            <option value="PLW" title="PW" >Palau</option>
            <option value="PRY" title="PY" >Paraguay</option>
            <option value="QAT" title="QA" >Qatar</option>
            <option value="ROU" title="RO" >Romania</option>
            <option value="SRB" title="RS" >Serbia</option>
            <option value="RUS" title="RU" >Russia</option>
            <option value="RWA" title="RW" >Rwanda</option>
            <option value="SAU" title="SA" >Saudi Arabia</option>
            <option value="SLB" title="SB" >Solomon Islands</option>
            <option value="SYC" title="SC" >Seychelles</option>
            <option value="SDN" title="SD" >Sudan</option>
            <option value="SWE" title="SE" >Sweden</option>
            <option value="SGP" title="SG" >Singapore</option>
            <option value="SVN" title="SI" >Slovenia</option>
            <option value="SVK" title="SK" >Slovak Republic</option>
            <option value="SLE" title="SL" >Sierra Leone</option>
            <option value="SMR" title="SM" >San Marino</option>
            <option value="SEN" title="SN" >Senegal</option>
            <option value="SOM" title="SO" >Somalia</option>
            <option value="SUR" title="SR" >Suriname</option>
            <option value="STP" title="ST" >Sao Tome and Principe</option>
            <option value="SLV" title="SV" >El Salvador</option>
            <option value="SYR" title="SY" >Syria</option>
            <option value="SWZ" title="SZ" >Swaziland</option>
            <option value="TCD" title="TD" >Chad</option>
            <option value="TGO" title="TG" >Togo</option>
            <option value="THA" title="TH" >Thailand</option>
            <option value="TJK" title="TJ" >Tajikistan</option>
            <option value="TKM" title="TM" >Turkmenistan</option>
            <option value="TUN" title="TN" >Tunisia</option>
            <option value="TON" title="TO" >Tonga</option>
            <option value="TUR" title="TR" >Turkey</option>
            <option value="TTO" title="TT" >Trinidad and Tobago</option>
            <option value="TUV" title="TV" >Tuvalu</option>
            <option value="TWN" title="TW" >Taiwan</option>
            <option value="TZA" title="TZ" >Tanzania</option>
            <option value="UKR" title="UA" >Ukraine</option>
            <option value="UGA" title="UG" >Uganda</option>
            <option value="URY" title="UY" >Uruguay</option>
            <option value="UZB" title="UZ" >Uzbekistan</option>
            <option value="VCT" title="VC" >Saint Vincent And The Grenadine</option>
            <option value="VEN" title="VE" >Venezuela</option>
            <option value="VGB" title="VG" >British Virgin Islands</option>
            <option value="VNM" title="VN" >Vietnam</option>
            <option value="VUT" title="VU" >Vanuatu</option>
            <option value="WLF" title="WF" >Wallis and Futuna</option>
            <option value="WSM" title="WS" >Western Samoa</option>
            <option value="YEM" title="YE" >Yemen</option>
            <option value="ZAF" title="ZA" >South Africa</option>
            <option value="ZMB" title="ZM" >Zambia</option>
            <option value="ZWE" title="ZW" >Zimbabwe</option>
        </select>
            <!--<input type="text" class="form-control" id="country" name="country" placeholder="Country" />-->
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="email"  name="email" placeholder="Email." />
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="major" name="major" placeholder="What's ur major?" />
        </div>
        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="interest" name="interest" placeholder="What's ur interest?" />
        </div>

        <div class="registerbox-textbox">
            <input type="text" class="form-control" id="passport_no" name="Passport_no" placeholder="Passport No." />
        </div>

        <div class="registerbox-submit">
            <input type="button" class="btn btn-primary pull-right" value="SUBMIT">
        </div>
    </div>
    <div class="logobox">
    </div>


</div>


<!--Google Analytics::Demo Only-->
<script>
    $("body").mLoading({
        text:"Please wating....",//加载文字，默认值：加载中...
        icon:"",//加载图标，默认值：一个小型的base64的gif图片
        html:false,//设置加载内容是否是html格式，默认值是false
        content:"Please wating....",//忽略icon和text的值，直接在加载框中显示此值
        mask:true//是否显示遮罩效果，默认显示
    });
    $("body").mLoading("hide");//隐藏loading组件
    var headdata;
    var input1 = document.getElementById("upload");

    if(typeof FileReader==='undefined'){
        input1.setAttribute('disabled','disabled');
    }else{
        input1.addEventListener('change',readFile,false);
    }
    function readFile(){
        var file = this.files[0];//获取上传文件列表中第一个文件
        if(!/image\/\w+/.test(file.type)){
            alert("文件必须为图片！");
            return false;
        }
        var reader = new FileReader();//实例一个文件对象
        reader.readAsDataURL(file);//把上传的文件转换成url
        //当文件读取成功便可以调取上传的接口
        reader.onload = function(e){
            var data = e.target.result.split(',');
            var tp = (file.type == 'image/png')? 'png': 'jpg';
            var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
            //需要上传到服务器的在这里可以进行ajax请求
            headdata=e.target.result;
            var image = new Image();
            // 设置src属性
            image.src = e.target.result;
            var max=1024;
            // 绑定load事件处理器，加载完成后执行，避免同步问题
            image.onload = function(){
                // 获取 canvas DOM 对象
                var canvas = document.getElementById("cvs");
                var canvas_hidden = document.getElementById("cvs_hidden");
                // 如果高度超标 宽度等比例缩放 *=
                if(image.height > max) {
                    image.width *= max / image.height;
                    image.height = max;
                }
                $("#cvs_hidden").attr('width',image.width);
                $("#cvs_hidden").attr('height',image.height);
                var ctx_hidden = canvas_hidden.getContext("2d");
                ctx_hidden.clearRect(0, 0, canvas_hidden.width, canvas_hidden.height);
                ctx_hidden.drawImage(image, 0, 0, image.width, image.height);
                headdata=canvas_hidden.toDataURL('image/jpeg',1.0);
                // 获取 canvas的 2d 环境对象,
                var ctx = canvas.getContext("2d");
                // canvas清屏
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(image, 0, 0, 100, 100);
            };

        }
    };
    $(document).ready(function(){

        $("input[type='button']").click(function () {

            $phone_no=$('#phone_no').val();
            $country=$('#country option:selected').text();
            $name=$('#name').val();
            $password=$('#password').val();
            $passport_no=$('#passport_no').val();
            $interest=$('#interest').val();
            $major=$('#major').val();
            console.log($country);
            if(checkdata()){
                post_data();
            }
        });
        function checkdata() {
            if(!$('#upload').val()){
                alert("Please choose a head icon.");
                return false;
            }
            if($phone_no==''||$country==''||$name==''||$passport_no==''){
                alert('Data can\'t be empty. ');
                return false;
            }
            if($phone_no.length!=11){
                alert('Phone No is invalid,Please check.');
                return false;
            }
            if($password.length<6) {
                alert('Password lengh must be over 6 numbers.');
                return false;
            }
            return validate_pass();
        }
        /**
         * 验证密码
         */
        function validate_pass() {
            var pwd = $("#password").val();
            var pwd1 = $("#password1").val();
            <!-- 对比两次输入的密码 -->
            if (pwd == pwd1) {
                return true;
            }
            else {
                $ ('#password_alert').show ().delay (3000).fadeOut ();
                return false;
            }
        }
        /**
         * 发送数据
         */
        function post_data() {
            $.post("{:url('Login/register')}", {
                telephone:$('#phone_no').val(),
                password:$('#password').val(),
                country:$('#country option:selected').text(),
                username:$('#name').val(),
                email:$('#email').val(),
                passport_no:$('#passport_no').val(),
                interest:$('#interest').val(),
                major:$('#major').val(),
                headimg:headdata,
                sex:$('#sex').val(),
            },function(d){
                if(d.error){
                    $.toast({
                        heading: 'Warning',
                        text: d.error,
                        showHideTransition: 'plain',
                        icon: 'warning'
                    })
                }else if(d.success){
                    $.toast({
                        heading: 'Success',
                        text: d.success,
                        showHideTransition: 'slide',
                        icon: 'success'
                    })
                    console.log("success");
                    if(d.url){
                        console.log("url");
                        setTimeout(function (){
                            location.href=d.url;
                        }, 1000);
                    }
                }
            });
        }
    });
//    (function (i, s, o, g, r, a, m) {
//        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
//            (i[r].q = i[r].q || []).push(arguments)
//        }, i[r].l = 1 * new Date(); a = s.createElement(o),
//            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
//    })(window, document, 'script', 'http://www.google-analytics.com/analytics.js', 'ga');
//    ga('create', 'UA-52103994-1', 'auto');
//    ga('send', 'pageview');

</script>
</body>
</html>
